!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6)))):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}(t,r),a(t,r,[]),t.module}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=function(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return"__useDefault"in(u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module)?u.__useDefault:u}}}(r.deps,r.depLoads,n);if(!r.executingRequire)for(i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}f=t.module=new o(r.moduleObj);if(!r.setters)for(i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a]));i(s);var v=u(e[0]);if(e.length>1)for(a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["f","d","1a","c"],!0,function($__System){this.require,this.exports,this.module;$__System.registerDynamic("b",["d","c"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_editor_1=$__require("d"),litegraph_js_1=$__require("c"),GraphTool=function(_super){function GraphTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="BEHAVIOR-GRAPH-TOOL",_this.tabName="Graph",_this._grid=null,_this}return __extends(GraphTool,_super),GraphTool.prototype.isSupported=function(object){return object instanceof litegraph_js_1.LGraphCanvas},GraphTool.prototype.resize=function(width,height){this._grid&&this._grid.element.resize()},GraphTool.prototype.update=function(node){this.object=node,this.object.graph.variables=this.object.graph.variables||[],this._buildGrid(),this._fillAllVariables()},GraphTool.prototype._buildGrid=function(){var _this=this;if(!this._grid){var div=$("#"+this.divId);div.css("width","100%"),div.css("height","100%"),this._grid=new babylonjs_editor_1.Grid("BEHAVIOR-GRAPH-TOOL",{header:"Variables",toolbarReload:!1,toolbarSearch:!1,toolbarEdit:!0}),this._grid.columns=[{field:"name",caption:"Name",size:"60%",editable:{type:"string"}},{field:"type",caption:"Type",size:"20%",editable:{type:"string"}},{field:"value",caption:"Value",size:"20%",editable:{type:"string"}}],this._grid.onAdd=function(){return _this._addVariable()},this._grid.onDelete=function(ids){return _this._removeVariables(ids)},this._grid.onEdit=function(id){return _this._editVariable(id)},this._grid.build("BEHAVIOR-GRAPH-TOOL")}},GraphTool.prototype._fillAllVariables=function(){var _this=this;this._grid.element.clear(),this.object.graph.variables.forEach(function(v,index){_this._grid.addRow({name:v.name,type:_this._getType(v.value),value:v.value.toString(),recid:index})}),this.object.graph.variables.length>0&&this._grid.select([0])},GraphTool.prototype._addVariable=function(){var _this=this,window=new babylonjs_editor_1.Window("GraphToolAddVariable");window.buttons=["Ok","Cancel"],window.width=450,window.height=170,window.body='<div id="GRAPH-TOOL-ADD-VARIABLE" style="width: 100%; height: 100%;"></div>',window.open();var form=new babylonjs_editor_1.Form("GRAPH-TOOL-ADD-VARIABLE");form.fields=[{name:"name",type:"text",required:!0,html:{span:10,caption:"The name of the variable."}},{name:"type",type:"list",required:!0,html:{span:10,caption:"Format"},options:{items:["String","Boolean","Number","Vector 2D","Vector 3D","Vector 4D"]}}],form.build("GRAPH-TOOL-ADD-VARIABLE"),form.element.record.name="My Variable",form.element.record.type="Number",form.element.refresh(),window.onButtonClick=function(id){if("Cancel"===id)return window.close();_this.object.graph.variables.push({name:form.element.record.name,value:_this._getValue(form.element.record.type.id)}),window.close(),_this._fillAllVariables()},window.onClose=function(){return form.element.destroy()}},GraphTool.prototype._removeVariables=function(ids){var _this=this,offset=0;ids.forEach(function(id){_this.object.graph.variables.splice(id-offset,1),offset++}),this._fillAllVariables()},GraphTool.prototype._editVariable=function(id){return __awaiter(this,void 0,void 0,function(){var v,window,form,_this=this;return __generator(this,function(_a){switch(v=this.object.graph.variables[id],(window=new babylonjs_editor_1.Window("GraphToolAddVariable")).buttons=["Ok","Cancel"],window.width=450,window.height=170,window.body='<div id="GRAPH-TOOL-EDIT-VARIABLE" style="width: 100%; height: 100%;"></div>',window.open(),(form=new babylonjs_editor_1.Form("GRAPH-TOOL-EDIT-VARIABLE")).fields=[{name:"name",type:"text",required:!0,html:{span:10,caption:"The name of the variable."}}],this._getType(v.value)){case"String":form.fields.push({name:"value",type:"text",required:!0,html:{span:10,caption:"Value"}});break;case"Number":form.fields.push({name:"value",type:"float",required:!0,html:{span:10,caption:"Value"}});break;case"Boolean":form.fields.push({name:"value",type:"checkbox",required:!0,html:{span:10,caption:"Value"}});break;case"Vector 2D":form.fields.push({name:"x",type:"float",required:!0,html:{span:10,caption:"X"}}),form.fields.push({name:"y",type:"float",required:!0,html:{span:10,caption:"Y"}});break;case"Vector 3D":form.fields.push({name:"x",type:"float",required:!0,html:{span:10,caption:"X"}}),form.fields.push({name:"y",type:"float",required:!0,html:{span:10,caption:"Y"}}),form.fields.push({name:"z",type:"float",required:!0,html:{span:10,caption:"z"}});break;case"Vector 4D":form.fields.push({name:"x",type:"float",required:!0,html:{span:10,caption:"X"}}),form.fields.push({name:"y",type:"float",required:!0,html:{span:10,caption:"Y"}}),form.fields.push({name:"z",type:"float",required:!0,html:{span:10,caption:"z"}}),form.fields.push({name:"w",type:"float",required:!0,html:{span:10,caption:"w"}})}return form.build("GRAPH-TOOL-EDIT-VARIABLE"),form.element.record.name=v.name,form.element.record.value="string"===(typeof v.value).toLowerCase()?v.value:"boolean"===(typeof v.value).toLowerCase()?v.value:JSON.stringify(v.value),form.element.record.x=v.value[0],form.element.record.y=v.value[1],form.element.record.z=v.value[2],form.element.record.w=v.value[3],form.element.refresh(),window.onButtonClick=function(id){if("Cancel"===id)return window.close();switch(v.name=form.element.record.name,_this._getType(v.value)){case"String":v.value=form.element.record.value;break;case"Number":case"Boolean":v.value=JSON.parse(form.element.record.value);break;case"Vector 2D":v.value=[parseFloat(form.element.record.x),parseFloat(form.element.record.y)];break;case"Vector 3D":v.value=[parseFloat(form.element.record.x),parseFloat(form.element.record.y),parseFloat(form.element.record.z)];break;case"Vector 4D":v.value=[parseFloat(form.element.record.x),parseFloat(form.element.record.y),parseFloat(form.element.record.z),parseFloat(form.element.record.w)]}window.close(),_this._fillAllVariables()},window.onClose=function(){return form.element.destroy()},[2]})})},GraphTool.prototype._getValue=function(type){switch(type){case"String":return"My Value";case"Number":return 0;case"Boolean":return!1;case"Vector 2D":return[0,0];case"Vector 3D":return[0,0,0];case"Vector 4D":return[0,0,0,0]}},GraphTool.prototype._getType=function(value){switch(babylonjs_editor_1.Tools.GetConstructorName(value).toLowerCase()){case"string":return"String";case"number":return"Number";case"boolean":return"Boolean";case"array":switch(value.length){case 2:return"Vector 2D";case 3:return"Vector 3D";case 4:return"Vector 4D";default:return null}default:return null}},GraphTool}(babylonjs_editor_1.AbstractEditionTool);exports.default=GraphTool}),$__System.registerDynamic("e",["f","d","c","10","11","12","13"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__values=exports&&exports.__values||function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),babylonjs_editor_1=$__require("d"),litegraph_js_1=$__require("c"),types_1=$__require("10"),graph_type_node_1=$__require("11"),graph_function_node_1=$__require("12"),graph_node_1=$__require("13"),GraphNodeTool=function(_super){function GraphNodeTool(){var _this=_super.call(this)||this;return _this.divId="BEHAVIOR-GRAPH-NODE-TOOL",_this.tabName="Graph Node",_this._array=[],_this._allowedTypes=["vector2","vector3","vector4","color3","color4","number","string","boolean"],_this}return __extends(GraphNodeTool,_super),GraphNodeTool.prototype.isSupported=function(object){return object instanceof types_1.IGraphNode||object instanceof litegraph_js_1.LGraphGroup},GraphNodeTool.prototype.update=function(node){if(_super.prototype.update.call(this,node),node instanceof litegraph_js_1.LGraphGroup)return this._setupGroup(node);node.desc&&this.tool.addTextBox(node.desc),node instanceof graph_type_node_1.GraphTypeNode?this._setupNodeType(node):node instanceof graph_function_node_1.GraphFunctionNode?this._setupNodeFunction(node):node instanceof graph_node_1.GraphNode&&this._setupNode(node)},GraphNodeTool.prototype._setupNode=function(node){var e_1,_a,_this=this;if(node.description.properties){var _loop_1=function(property){var value=node.properties[property.name];if(property.enums)return this_1.tool.add(node.properties,property.name,property.enums).name(property.name).onChange(function(r){property.enumsTarget&&(node.properties[property.name]=property.enumsTarget[r]),_this._updateWidgets(property.name,r)}),"continue";if("Property Path"===property.name)return this_1._setupPropertyPath(property.name),"continue";if("Target Path"===property.name)return this_1._setupTargetPath(property.name),"continue";if("Sound Name"===property.name)return this_1._setupSoundName(property.name),"continue";if("Variable"===property.name){var variables=node.graph.variables.map(function(v){return v.name});return this_1.tool.add(node.properties,property.name,variables).name(property.name),"continue"}switch(babylonjs_editor_1.Tools.GetConstructorName(value).toLowerCase()){case"number":case"string":case"boolean":this_1.tool.add(node.properties,property.name).name(property.name).onChange(function(r){return _this._updateWidgets(property.name,r)});break;case"array":switch(value.length){case 2:case 3:case 4:var names_1="col3"===property.type||"col4"===property.type?["r","g","b","a"]:["x","y","z","w"];value.forEach(function(v,index){var o={v:v};_this.tool.add(o,"v").name(names_1[index]).onChange(function(r){return node.properties.value[index]=r})})}}},this_1=this;try{for(var _b=__values(node.description.properties),_c=_b.next();!_c.done;_c=_b.next()){_loop_1(_c.value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}}},GraphNodeTool.prototype._setupNodeType=function(node){var _this=this,value=node.properties.Value;switch(babylonjs_editor_1.Tools.GetConstructorName(value).toLowerCase()){case"number":case"string":case"boolean":this.tool.add(node.properties,"Value").name("Value");break;case"array":switch(value.length){case 2:case 3:case 4:var names_2=node.defaultValue instanceof babylonjs_1.Color3||node.defaultValue instanceof babylonjs_1.Color4?["r","g","b","a"]:["x","y","z","w"];value.forEach(function(v,index){var o={v:v};_this.tool.add(o,"v").name(names_2[index]).onChange(function(r){return node.properties.Value[index]=r})})}}},GraphNodeTool.prototype._setupNodeFunction=function(node){},GraphNodeTool.prototype._setupGroup=function(node){this.tool.add(node,"title").name("Title").onChange(function(_){return node.graph.setDirtyCanvas(!0,!0)}),this.tool.addHexColor(node,"color").onChange(function(_){return node.graph.setDirtyCanvas(!0,!0)})},GraphNodeTool.prototype._setupSoundName=function(property){var sounds=["None"].concat(this.editor.core.scene.mainSoundTrack.soundCollection.map(function(s){return s.name}));this.tool.add(this.object.properties,property,sounds).name("Sound Name")},GraphNodeTool.prototype._setupPropertyPath=function(property){var _this=this,f=this.tool.addFolder("Property Path");f.open(),f.add(this.object.properties,property).name("Property Path"),f.add(this,"_browsePropertyPath").name("Browse..."),this._onPropertySelected=function(path){_this.object.properties[property]=path,_this.update(_this.object)}},GraphNodeTool.prototype._setupTargetPath=function(property){var nodes=["Self","Scene"].concat(this.editor.core.scene.meshes.map(function(m){return m.name})).concat(this.editor.core.scene.lights.map(function(l){return l.name})).concat(this.editor.core.scene.cameras.map(function(c){return c.name}));this.tool.add(this.object.properties,property,nodes).name("Target")},GraphNodeTool.prototype._updateWidgets=function(name,value){var widget=this.object.widgets&&this.object.widgets.find(function(w){return w.name===name});widget&&(widget.value=value,this.object.setDirtyCanvas(!0,!0),this.object.computeSize())},GraphNodeTool.prototype._browsePropertyPath=function(){return __awaiter(this,void 0,void 0,function(){var deepTypes,targetPath,target,window,tree,fill,search,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return deepTypes=[babylonjs_1.Material],targetPath=this.object.properties["Target Path"],target=targetPath?graph_node_1.GraphNode.GetTargetPath(targetPath,this.object.graph.scriptObject,this.editor.core.scene):this.object.graph.scriptObject,(window=new babylonjs_editor_1.Window("PropertyBrowser")).body='\n            <input id="NODE-TOOL-GRAPH-SEARCH" type="text" placeHolder="Search" style="width: 100%; height: 40px;" />\n            <div id="NODE-TOOL-PROPERTY-BORWSER" style="width: 100%; height: calc(100% - 40px); overflow: auto;"></div>',window.title="Select Property of "+(target instanceof babylonjs_1.Scene?"Scene":target.name),window.buttons=["Select","Cancel"],[4,window.open()];case 1:return _a.sent(),window.onButtonClick=function(id){switch(id){case"Select":var selected=tree.getSelected();if(!selected)return;var property=graph_node_1.GraphNode.GetProperty(target,selected.data),ctor=graph_node_1.GraphNode.GetConstructorName(property).toLowerCase();if(-1===_this._allowedTypes.indexOf(ctor))return;_this._onPropertySelected(selected.data)}window.close()},(tree=new babylonjs_editor_1.Tree("NodeToolPropertyBrowser")).wholerow=!0,tree.multipleSelection=!1,tree.build("NODE-TOOL-PROPERTY-BORWSER"),(fill=function(root,propertyName){var _loop_2=function(key){if("_"===key[0])return"continue";var value=root[key],ctor=babylonjs_editor_1.Tools.GetConstructorName(value).toLowerCase(),allowed=-1!==_this._allowedTypes.indexOf(ctor),deep=deepTypes.find(function(dt){return value instanceof dt});if(!allowed&&!deep)return"continue";var id=(""===propertyName?"":propertyName+".")+key;tree.add({text:key,id:id,img:"icon-edit",data:id},""!==propertyName?propertyName:void 0);var type=(typeof value).toLowerCase();"string"!==type&&"number"!==type&&"boolean"!==type&&fill(value,id)};for(var key in root)_loop_2(key)})(target,""),(search=$("#NODE-TOOL-GRAPH-SEARCH")).keyup(function(){tree.search(search.val())}),setTimeout(function(){return search.focus()},1),[2]}})})},GraphNodeTool}(babylonjs_editor_1.AbstractEditionTool);exports.default=GraphNodeTool}),$__System.registerDynamic("14",["c","d"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("c"),babylonjs_editor_1=$__require("d"),GraphNodeCreator=function(){function GraphNodeCreator(){}return GraphNodeCreator.Show=function(){var _this=this;this._Search.value="",this._SearchStr="",setTimeout(function(){return _this._Search.focus()},1),this.Hide(),this.Reset(),this._Root.style.width=this.Width+"px",this._Root.style.height=this.Height+"px",this._Root.style.left=.5*innerWidth-.5*this.Width+"px",this._Root.style.top=.5*innerHeight-.5*this.Height+"px",this._Root.style.visibility="",this._ReturnEvent=function(ev){13===ev.keyCode&&_this.OnConfirmSelection(_this._Graph.getSelected().id)},window.addEventListener("keyup",this._ReturnEvent),document.body.appendChild(this._Root)},GraphNodeCreator.Hide=function(){this._Root.style.visibility="hidden",this._ReturnEvent&&(window.removeEventListener("keyup",this._ReturnEvent),this._ReturnEvent=null)},GraphNodeCreator.Reset=function(){var _this=this,nodes=litegraph_js_1.LiteGraph.registered_node_types;for(var n in nodes)this._Graph.element.hide(n);var toShow=[],effectiveSearch=this._SearchStr.replace(/ /g,""),_loop_1=function(s){var visible=this_1._Sorted[s].filter(function(v){var ctor=litegraph_js_1.LiteGraph.registered_node_types[s+"/"+v];return!!ctor&&-1!==ctor.Title.replace(/ /g,"").toLowerCase().indexOf(effectiveSearch.toLowerCase())});0===visible.length?(this_1._Graph.element.set(s,{group:!1}),this_1._Graph.element.hide(s)):(this_1._Graph.element.set(s,{group:!0}),this_1._Graph.element.show(s)),visible.forEach(function(v){return toShow.push(s+"/"+v)})},this_1=this;for(var s in this._Sorted)_loop_1(s);toShow.forEach(function(ts){return _this._Graph.element.show(ts)}),setTimeout(function(){_this._Graph.element.refresh(),toShow.length>0&&(_this._Graph.setSelected(toShow[0]),_this._Graph.element.scrollIntoView(toShow[0]),_this._Empty.style.visibility="hidden"),_this._Empty.style.visibility=""},1)},GraphNodeCreator.Init=function(){var _this=this;this._Root.appendChild(this._Title),this._Title.textContent="Create new node",this._Root.appendChild(this._Search),this._Search.setAttribute("placeHolder","Search..."),this._Search.classList.add("editorSearch"),this._Search.addEventListener("keyup",function(){_this._SearchTimeout&&clearTimeout(_this._SearchTimeout),_this._SearchTimeout=setTimeout(function(){_this._SearchStr=_this._Search.value,_this.Reset(),_this._SearchTimeout=null},100)}),this._Root.appendChild(this._GraphDiv),this._Graph=new babylonjs_editor_1.Graph(this._GraphDiv.id),this._Graph.build(this._GraphDiv),this._Graph.onDbleClick=function(id,data){return _this.OnConfirmSelection(id)},this._GraphDiv.appendChild(this._Empty),this._Empty.textContent="Empty",document.addEventListener("click",function(ev){babylonjs_editor_1.Tools.IsElementChildOf(ev.target,_this._Root)||_this.Hide()})},GraphNodeCreator.InitItems=function(){var _this=this;this._Graph.clear(),this._Sorted={};var nodes=litegraph_js_1.LiteGraph.registered_node_types;for(var n in nodes){var split=n.split("/");(this._Sorted[split[0]]||(this._Sorted[split[0]]=[])).push(split[1])}this._Graph.add({id:"group",text:"Group",img:"icon-folder"});var _loop_2=function(s){var value=this_2._Sorted[s];this_2._Graph.add({id:s,text:s,group:!0}),value.forEach(function(v){var id=s+"/"+v,ctor=litegraph_js_1.LiteGraph.registered_node_types[id],desc=ctor.Desc,description=desc?desc.length>30?desc.substr(0,30)+"...":desc:"";_this._Graph.add({id:id,text:ctor.Title,data:v,img:"icon-help",count:description})})},this_2=this;for(var s in this._Sorted)_loop_2(s)},GraphNodeCreator.Width=400,GraphNodeCreator.Height=400,GraphNodeCreator._Root=babylonjs_editor_1.Tools.CreateElement("div","GRAPH-CANVAS-NODE-CREATOR",{position:"absolute",overflow:"hidden",visibility:"hidden",opacity:"0.99","background-color":"rgb(64, 64, 64)","box-shadow":"1px 2px 4px rgba(0, 0, 0, .5)","border-radius":"2px"}),GraphNodeCreator._Title=babylonjs_editor_1.Tools.CreateElement("h3","GRAPH-CANVAS-NODE-CREATOR-TITLE",{width:"100%",height:"25px",position:"relative",top:"-18px","background-color":"rgb(16, 16, 16)","text-align":"center",color:"grey"}),GraphNodeCreator._Search=babylonjs_editor_1.Tools.CreateElement("input","GRAPH-CANVAS-NODE-CREATOR-SEARCH",{width:"100%",height:"20px",position:"relative",top:"-40px"}),GraphNodeCreator._GraphDiv=babylonjs_editor_1.Tools.CreateElement("div","GRAPH-CANVAS-NODE-CREATOR-SIDEBAR",{width:"100%",height:"calc(100% - 55px)",position:"relative",top:"-40px"}),GraphNodeCreator._Empty=babylonjs_editor_1.Tools.CreateElement("h1","GRAPH-CANVAS-NODE-CREATOR-EMPTY",{float:"left",left:"50%",top:"50%",transform:"translate(-50%, -50%)",overflow:"hidden",position:"relative","font-family":"Roboto,sans-serif !important",opacity:"0.5"}),GraphNodeCreator._Graph=null,GraphNodeCreator._SearchTimeout=null,GraphNodeCreator._SearchStr="",GraphNodeCreator._Sorted={},GraphNodeCreator}();exports.default=GraphNodeCreator}),$__System.registerDynamic("15",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("11",["13","10"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var graph_node_1=$__require("13"),types_1=$__require("10");exports.registerTypeNode=function(path,name,description,getDefaultValue){var _a;graph_node_1.GraphNode.RegisterNode(path,((_a=function(_super){function class_1(){var _this=_super.call(this,getDefaultValue)||this;return _this.title=name,_this.desc=description,_this}return __extends(class_1,_super),class_1}(GraphTypeNode)).Title=name,_a.Desc=description,_a))};var GraphTypeNode=function(_super){function GraphTypeNode(getDefaultValue){var _this=_super.call(this)||this;_this.defaultValue=getDefaultValue();var type=graph_node_1.GraphNode.GetConstructorName(_this.defaultValue).toLowerCase();switch(type){case"number":case"string":_this.addProperty("Value",_this.defaultValue);break;case"vector2":type="vec2",_this.addProperty("Value",graph_node_1.GraphNode.vector3ToVec3(_this.defaultValue));break;case"vector3":type="vec3",_this.addProperty("Value",graph_node_1.GraphNode.vector3ToVec3(_this.defaultValue));break;case"vector4":type="vec4",_this.addProperty("Value",graph_node_1.GraphNode.vector4ToVec4(_this.defaultValue));break;case"color3":type="col3",_this.addProperty("Value",graph_node_1.GraphNode.color3ToCol3(_this.defaultValue));break;case"color4":type="col4",_this.addProperty("Value",graph_node_1.GraphNode.color4ToCol4(_this.defaultValue))}return _this.addOutput("Value",type),GraphTypeNode._VectorOuputs.forEach(function(v){return void 0!==_this.defaultValue[v]&&_this.addOutput(v,"number")}),GraphTypeNode._ColorOutputs.forEach(function(v){return void 0!==_this.defaultValue[v]&&_this.addOutput(v,"number")}),_this}return __extends(GraphTypeNode,_super),GraphTypeNode.prototype.onExecute=function(){var _this=this;this.setOutputData(0,this.properties.Value),GraphTypeNode._VectorOuputs.forEach(function(v,index){return void 0!==_this.defaultValue[v]&&_this.setOutputData(index+1,_this.properties.Value[index])}),GraphTypeNode._ColorOutputs.forEach(function(v,index){return void 0!==_this.defaultValue[v]&&_this.setOutputData(index+1,_this.properties.Value[index])})},GraphTypeNode.prototype.onDrawBackground=function(ctx){if(!this.flags.collapsed){ctx.font="14px Arial",ctx.fillStyle="grey",ctx.textAlign="center";var text=this.properties.Value.toString(),measure=ctx.measureText(text);this.size[0]<=measure.width&&(this.size[0]=measure.width+100),ctx.fillText(text,.5*this.size[0],this.size[1]+15)}},GraphTypeNode._VectorOuputs=["x","y","z","w"],GraphTypeNode._ColorOutputs=["r","g","b","a"],GraphTypeNode}(types_1.IGraphNode);exports.GraphTypeNode=GraphTypeNode}),$__System.registerDynamic("16",["f","11"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),graph_type_node_1=$__require("11");exports.registerAllTypeNodes=function(object){graph_type_node_1.registerTypeNode("types/number","Number","Represents a number",function(){return 0}),graph_type_node_1.registerTypeNode("types/string","String","Represents a string",function(){return"new string"}),graph_type_node_1.registerTypeNode("types/vector2","Vector2","Represents a Vector 2D",function(){return babylonjs_1.Vector2.Zero()}),graph_type_node_1.registerTypeNode("types/vector3","Vector3","Represents a Vector3D",function(){return babylonjs_1.Vector3.Zero()}),graph_type_node_1.registerTypeNode("types/vector4","Vector4","Represents a Vector4D",function(){return babylonjs_1.Vector4.Zero()}),graph_type_node_1.registerTypeNode("types/color3","Color3","Represents a Color3",function(){return babylonjs_1.Color3.Black()}),graph_type_node_1.registerTypeNode("types/color4","Color4","Represents a Color4",function(){return new babylonjs_1.Color4(0,0,0,1)})}}),$__System.registerDynamic("12",["c","10","17"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("c"),types_1=$__require("10"),graph_1=$__require("17");exports.registerFunctionNode=function(ctor,object,path,name,description,methodName,args,returnType){var _a;(!object||object instanceof ctor)&&graph_1.GraphNode.RegisterNode(path,((_a=function(_super){function class_1(){var _this=_super.call(this,methodName,args,returnType)||this;return _this.title=name,_this.desc=description,_this}return __extends(class_1,_super),class_1}(GraphFunctionNode)).Title=name,_a.Desc=description,_a))};var GraphFunctionNode=function(_super){function GraphFunctionNode(methodName,args,returnType){var _this=_super.call(this)||this;return _this._isValid=!1,_this._methodName=methodName,_this._args=args,_this._returnType=returnType,_this._configureInputs(),_this._configureOutput(),_this.computeSize(),_this}return __extends(GraphFunctionNode,_super),GraphFunctionNode.prototype.onExecute=function(){var _this=this,target=this.graph.scriptObject,method=target[this._methodName];if(!method)return console.warn('No method exists on target: "'+this._methodName+'"');this._isValid=!0;var args=this._args.map(function(a,index){var i=_this.getInputData(index+1);if(null!=i||a.optional)return graph_1.GraphNode.nodeToOutput(i);_this._isValid=!1});this.setNodeState(!this._isValid),this._isValid&&method.apply(target,args)},GraphFunctionNode.prototype.onDrawBackground=function(ctx){this.flags.collapsed},GraphFunctionNode.prototype._configureInputs=function(){var _this=this;this.addInput("Execute",litegraph_js_1.LiteGraph.EVENT),this._args.forEach(function(a,index){return _this.addInput(a.name+(a.optional?"":" *"),a.type)})},GraphFunctionNode.prototype._configureOutput=function(){this._returnType&&this.addOutput(this._returnType.name,this._returnType.type)},GraphFunctionNode}(types_1.IGraphNode);exports.GraphFunctionNode=GraphFunctionNode}),$__System.registerDynamic("18",["f","12"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),graph_function_node_1=$__require("12");exports.registerAllFunctionNodes=function(object){graph_function_node_1.registerFunctionNode(babylonjs_1.AbstractMesh,object,"functions/movewithcollisions","Move With Collisions","Move the mesh using collision engine.","moveWithCollisions",[{name:"displacement",type:"vec3",optional:!1}]),graph_function_node_1.registerFunctionNode(babylonjs_1.AbstractMesh,object,"functions/lookat","Look At","Orients a mesh towards a target point. Mesh must be drawn facing user.","lookAt",[{name:"target point",type:"vec3",optional:!1},{name:"yawCor",type:"number",optional:!0},{name:"pitchCor",type:"number",optional:!0},{name:"rollCor",type:"number",optional:!0}]),graph_function_node_1.registerFunctionNode(babylonjs_1.AbstractMesh,object,"functions/rotate","Rotate","Rotates the mesh around the axis vector for the passed angle (amount) expressed in radians, in the local space.","rotate",[{name:"axis",type:"vec3",optional:!1},{name:"amount",type:"number",optional:!1}]),graph_function_node_1.registerFunctionNode(babylonjs_1.AbstractMesh,object,"functions/translate","Translate","Translates the mesh along the axis vector for the passed distance in the local space.","translate",[{name:"axis",type:"vec3",optional:!1},{name:"distance",type:"number",optional:!1}]),graph_function_node_1.registerFunctionNode(babylonjs_1.AbstractMesh,object,"functions/setdirection","Set Direction","Sets this transform node rotation to the given local axis.","setDirection",[{name:"localAxis",type:"vec3",optional:!1},{name:"yawCor",type:"number",optional:!0},{name:"pitchCor",type:"number",optional:!0},{name:"rollCor",type:"number",optional:!0}])}}),$__System.registerDynamic("19",["f","c","13","1a"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13"),extensions_1=$__require("1a");exports.registerAllUtilsNodes=function(object){graph_node_1.registerNode({name:"Bypass Type",description:"Removes the type of the input",path:"utils/bypass",ctor:Object,inputs:[{name:"In",type:void 0}],outputs:[{name:"Out",type:void 0,inputName:"In"}]},object),graph_node_1.registerNode({name:"Time",description:"Returns the current time in milliseconds or seconds",path:"utils/time",ctor:Object,functionRef:function(node,target){return node.setOutputData(1,node.graph.globaltime),1e3*node.graph.globaltime},outputs:[{name:"ms",type:"number"},{name:"sec",type:"number"}],drawBackground:function(node){return(1e3*node.graph.globaltime).toString()}},object),graph_node_1.registerNode({name:"Log",description:"Logs the given message",path:"utils/log",ctor:Object,functionRef:function(node){console[node.properties.Level.toLowerCase()](node.properties.Message,node.getInputData(1))},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Message",type:void 0}],properties:[{name:"Message",type:"string",defaultValue:"My Message"},{name:"Level",type:"string",defaultValue:"Info",enums:["Info","Warn","Error"]}],drawBackground:function(node){return node.properties.Level+": "+node.properties.Message+", "+(node.getInputData(1)||"").toString()}},object),graph_node_1.registerNode({name:"Set Timeout",description:"Triggers the next node(s) after x milliseconds",path:"utils/settimeout",ctor:Object,functionRef:function(node){node.store.ids=node.store.ids||[];var ms=node.getInputData(1)||node.properties["Time (ms)"],id=setTimeout(function(){return node.triggerSlot(0)},ms);node.store.ids.push(id),node.setOutputData(1,id)},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Time (ms)",type:"number"}],properties:[{name:"Time (ms)",type:"number",defaultValue:1e3}],outputs:[{name:"Time out",type:litegraph_js_1.LiteGraph.EVENT},{name:"Id",type:"number"}],onStop:function(node){node.store.ids&&node.store.ids.forEach(function(id){return clearTimeout(id)})}},object),graph_node_1.registerNode({name:"Clear Timeout",description:"Clears the given timeout Id",path:"utils/cleartimeout",ctor:Object,functionRef:function(node){clearTimeout(node.getInputData(1))},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Id",type:"number"}]},object),graph_node_1.registerNode({name:"Vector 2D to XY",description:"Takes a vector as parameter and ouputs its x and y",path:"utils/vec2toxy",ctor:Object,functionRef:function(node){var v=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0));return v&&node.setOutputData(1,v.y),v.x},inputs:[{name:"In Vector",type:"vec2"}],outputs:[{name:"x",type:"number"},{name:"y",type:"number"}]},object),graph_node_1.registerNode({name:"Vector 3D to XYZ",description:"Takes a vector as parameter and ouputs its x, y and z",path:"utils/vec3toxyz",ctor:Object,functionRef:function(node){var v=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0));return v&&(node.setOutputData(1,v.y),node.setOutputData(2,v.z)),v.x},inputs:[{name:"In Vector",type:"vec3"}],outputs:[{name:"x",type:"number"},{name:"y",type:"number"},{name:"z",type:"number"}]},object),graph_node_1.registerNode({name:"Vector 4D to XYZW",description:"Takes a vector as parameter and ouputs its x, y, z and w",path:"utils/vec4toxyzw",ctor:Object,functionRef:function(node){var v=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0));return v&&(node.setOutputData(1,v.y),node.setOutputData(2,v.z),node.setOutputData(3,v.w)),v.x},inputs:[{name:"In Vector",type:"vec4"}],outputs:[{name:"x",type:"number"},{name:"y",type:"number"},{name:"z",type:"number"},{name:"w",type:"number"}]},object),graph_node_1.registerNode({name:"Color 3 to RGB",description:"Takes a color as parameter and ouputs its r, g and b",path:"utils/col3torgb",ctor:Object,functionRef:function(node){var c=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0),!0);return c&&(node.setOutputData(1,c.g),node.setOutputData(2,c.b)),c.r},inputs:[{name:"In Color",type:"col3"}],outputs:[{name:"r",type:"number"},{name:"g",type:"number"},{name:"b",type:"number"}],onGetInputs:function(){return[["pos","vec3"]]}},object),graph_node_1.registerNode({name:"Color 4 to RGBA",description:"Takes a color as parameter and ouputs its r, g, b and a",path:"utils/col4torgba",ctor:Object,functionRef:function(node){var c=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0),!0);return c&&(node.setOutputData(1,c.g),node.setOutputData(2,c.b),node.setOutputData(3,c.a)),c.r},inputs:[{name:"In Color",type:"col4"}],outputs:[{name:"r",type:"number"},{name:"g",type:"number"},{name:"b",type:"number"},{name:"a",type:"number"}]},object),graph_node_1.registerNode({name:"Vector Merger",description:"Exposes the XYZW properties to merge into 2d, 3d or 4d vectors.",path:"utils/vectormerger",ctor:Object,functionRef:function(node){return node.store.vector2=node.store.vector2||new babylonjs_1.Vector2(0,0),node.store.vector3=node.store.vector3||new babylonjs_1.Vector3(0,0,0),node.store.vector4=node.store.vector4||new babylonjs_1.Vector4(0,0,0,0),node.store.vector2.x=node.store.vector3.x=node.store.vector4.x=node.getInputData(0),node.store.vector2.y=node.store.vector3.y=node.store.vector4.y=node.getInputData(1),node.store.vector3.z=node.store.vector4.z=node.getInputData(2),node.store.vector4.w=node.getInputData(3),node.setOutputData(1,node.store.vector3.asArray()),node.setOutputData(2,node.store.vector4.asArray()),node.store.vector2},inputs:[{name:"x",type:"number"},{name:"y",type:"number"},{name:"z",type:"number"},{name:"w",type:"number"}],outputs:[{name:"Vector 2",type:"vec2"},{name:"Vector 3",type:"vec3"},{name:"Vector 4",type:"vec4"}]},object),graph_node_1.registerNode({name:"Send Script Message",description:"Sends a message to the given target by giving the method name and a parameter",path:"utils/sendmessage",ctor:Object,functionRef:function(node,target){var input=node.getInputData(1);extensions_1.default.Tools.sendMessage(target,node.properties["Method Name"],input)},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Value",type:void 0}],outputs:[],properties:[{name:"Target Path",type:"string",defaultValue:"Self"},{name:"Method Name",type:"string",defaultValue:""}],drawBackground:function(node){return node.properties["Target Path"]+"."+node.properties["Method Name"]}},object)}}),$__System.registerDynamic("1b",["f","c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllMathNodes=function(object){graph_node_1.registerNode({name:"Scale",description:"Scales",path:"math/scale",ctor:Object,functionRef:function(node){var vec=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1));return vec&&node.setOutputData(1,graph_node_1.GraphNode.inputToNode(vec.scale(node.properties.Amount))),node.getInputData(0)*node.properties.Amount},properties:[{name:"Amount",type:"number",defaultValue:1}],inputs:[{name:"Number",type:"number"},{name:"Vector",type:"vec2,vec3,vec4"}],outputs:[{name:"Scaled number",type:"number"},{name:"Scaled vector",type:"vec2,vec3,vec4"}],drawBackground:function(node){return node.properties.Amount.toString()}},object),graph_node_1.registerNode({name:"Operation",description:"Performs an operation (+, -, *, /)",path:"math/operation",ctor:Object,functionRef:function(node){var a=node.getInputData(0),b=node.getInputData(1);switch(node.properties.Operator){case"+":return a+b;case"-":return a-b;case"*":return a*b;case"/":return a/b;default:return 0}},properties:[{name:"Operator",type:"string",defaultValue:"+",enums:["+","-","*","/"]}],inputs:[{name:"a",type:"number"},{name:"b",type:"number"}],outputs:[{name:"Result",type:"number"}],drawBackground:function(node){switch(node.properties.Operator){case"+":return"Add";case"-":return"Subtract";case"*":return"Multiply";case"/":return"Divide";default:return""}}},object),graph_node_1.registerNode({name:"Vector Operation",description:"Performs a vector operation (+, -, *, /)",path:"math/vectoroperation",ctor:Object,functionRef:function(node){var a=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0)),b=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1));switch(node.properties.Operator){case"+":return a.add(b);case"-":return a.subtract(b);case"*":return a.multiply(b);case"/":return a.divide(b);default:return 0}},inputs:[{name:"vec1",type:"vec2,vec3,vec4"},{name:"vec2",type:"vec2,vec3,vec4"}],outputs:[{name:"Result",type:"vec2,vec3,vec4"}],properties:[{name:"Operator",type:"string",defaultValue:"+",enums:["+","-","*","/"]}],drawBackground:function(node){return node.properties.Operator}},object),graph_node_1.registerNode({name:"Fract",description:"Computes the fractional part of the input vector.",path:"math/fract",ctor:Object,functionRef:function(node){return graph_node_1.GraphNode.nodeToOutput(node.getInputData(0)).fract()},inputs:[{name:"Vector",type:"vec2,vec3,vec4"}],outputs:[{name:"Result",type:"vec2,vec3,vec4"}]},object),graph_node_1.registerNode({name:"Negate",description:"Computes the negation of the input value.",path:"math/negate",ctor:Object,functionRef:function(node){var v=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0));switch(graph_node_1.GraphNode.GetConstructorName(v).toLowerCase()){case"number":return-v;case"vector2":case"vector3":case"vector4":return v.negate()}},inputs:[{name:"Input",type:"number,vec2,vec3,vec4"}],outputs:[{name:"Result",type:"number,vec2,vec3,vec4"}]},object),graph_node_1.registerNode({name:"Condition",description:"Check the inputs and compares to trigger the appropriate slot.",path:"math/condition",ctor:Object,functionRef:function(node){var a=node.getInputData(1),b=node.getInputData(2);a===b&&node.triggerSlot(0),a!==b&&node.triggerSlot(1),a>=b&&node.triggerSlot(2),a<=b&&node.triggerSlot(3),a>b&&node.triggerSlot(4),a<b&&node.triggerSlot(5)},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"a",type:"number,boolean,string"},{name:"b",type:"number,boolean,string"}],outputs:[{name:"a == b",type:litegraph_js_1.LiteGraph.EVENT},{name:"a != b",type:litegraph_js_1.LiteGraph.EVENT},{name:"a >= b",type:litegraph_js_1.LiteGraph.EVENT},{name:"a <= b",type:litegraph_js_1.LiteGraph.EVENT},{name:"a > b",type:litegraph_js_1.LiteGraph.EVENT},{name:"a < b",type:litegraph_js_1.LiteGraph.EVENT}]},object),graph_node_1.registerNode({name:"For Loop",description:'Performs a "for loop" that will trigger the next nodes Nth times',path:"math/forloop",ctor:Object,functionRef:function(node){var i=node.getInputData(1);node.isInputValid(i)||(i=node.properties.Begin);var end=node.getInputData(2);node.isInputValid(end)||(end=node.properties.End);var increment=node.getInputData(3);for(node.isInputValid(increment)||(increment=node.properties.Increment);i<=end;i+=increment)node.setOutputData(1,i),node.triggerSlot(0)},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Begin",type:"number"},{name:"End",type:"number"},{name:"Increment",type:"number"}],outputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Indice",type:"number"}],properties:[{name:"Begin",defaultValue:0,type:"number"},{name:"End",defaultValue:32,type:"number"},{name:"Increment",defaultValue:1,type:"number"}],widgets:[{type:"number",name:"Begin",value:0,callback:function(v,g,n){return n.properties.Begin=v}},{type:"number",name:"End",value:32,callback:function(v,g,n){return n.properties.End=v}},{type:"number",name:"Increment",value:1,callback:function(v,g,n){return n.properties.Increment=v}}]},object),graph_node_1.registerNode({name:"Cosinus",description:"Performs a cosinus operation",path:"math/cos",ctor:Object,functionRef:function(node){return Math.cos(node.getInputData(0))},inputs:[{name:"In",type:"number"}],outputs:[{name:"Out",type:"number"}]},object),graph_node_1.registerNode({name:"Sinus",description:"Performs a sinus operation",path:"math/sin",ctor:Object,functionRef:function(node){return Math.sin(node.getInputData(0))},inputs:[{name:"In",type:"number"}],outputs:[{name:"Out",type:"number"}]},object),graph_node_1.registerNode({name:"Tangent",description:"Performs a tangent operation",path:"math/tan",ctor:Object,functionRef:function(node){return Math.tan(node.getInputData(0))},inputs:[{name:"In",type:"number"}],outputs:[{name:"Out",type:"number"}]},object),graph_node_1.registerNode({name:"Abs",description:"Returns the absolute position of the input number",path:"math/abs",ctor:Object,functionRef:function(node){return Math.abs(node.getInputData(0))||0},inputs:[{name:"In",type:"number"}],outputs:[{name:"Out",type:"number"}]},object),graph_node_1.registerNode({name:"Random",description:"Returns a random number in the given range",path:"math/random",ctor:Object,functionRef:function(node){return Math.random()*(node.properties.Max-node.properties.Min)+node.properties.Min},outputs:[{name:"Value",type:"number"}],properties:[{name:"Min",defaultValue:0,type:"number"},{name:"Max",defaultValue:1,type:"number"}]},object),graph_node_1.registerNode({name:"Floor",description:"Floors the given number of vector",path:"math/floor",ctor:Object,functionRef:function(node){var vec=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1));return vec&&node.setOutputData(1,graph_node_1.GraphNode.inputToNode(vec.floor())),Math.floor(node.getInputData(0)||0)},inputs:[{name:"Input Number",type:"number"},{name:"Input Vector",type:"vec2,vec3,vec4"}],outputs:[{name:"Number Result",type:"number"},{name:"Vector Result",type:"vec2,vec3,vec4"}]},object),graph_node_1.registerNode({name:"Exp",description:"Returns e (the base of natural logarithms) raised to the given power",path:"math/exp",ctor:Object,functionRef:function(node){var i=node.getInputData(0);return null==i?Math.exp(node.properties.Power):Math.exp(i)},inputs:[{name:"Power",type:"number"}],outputs:[{name:"Result",type:"number"}],properties:[{name:"Power",defaultValue:1,type:"number"}]},object),graph_node_1.registerNode({name:"Clamp",description:"Clamps the given value in the given interval [min, max]",path:"math/clamp",ctor:Object,functionRef:function(node){var val=graph_node_1.GraphNode.nodeToOutput(node.getInputData(0));if(node.isInputValid(val)){var min=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1));if(node.isInputValid(min)){var max=graph_node_1.GraphNode.nodeToOutput(node.getInputData(2));if(node.isInputValid(max))return val instanceof babylonjs_1.Vector2?babylonjs_1.Vector2.Clamp(val,min,max):val instanceof babylonjs_1.Vector3?babylonjs_1.Vector3.Clamp(val,min,max):babylonjs_1.Scalar.Clamp(val,min,max)}}},inputs:[{name:"Value",type:"number,vec2,vec3"},{name:"Min",type:"number,vec2,vec3"},{name:"Max",type:"number,vec2,vec3"}],outputs:[{name:"Result",type:"number,vec2,vec3"}]},object)}}),$__System.registerDynamic("1c",["c","13","f"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("c"),graph_node_1=$__require("13"),babylonjs_1=$__require("f");exports.registerAllPropertiesNodes=function(object){graph_node_1.registerNode({name:"Get Property",description:"Gets the property of the current node and returns its value.",path:"properties/getproperty",ctor:Object,properties:[{name:"Property Path",type:"string",defaultValue:"name"},{name:"Target Path",type:"string",defaultValue:object&&object.name?object.name:"Scene"}],outputs:[{type:void 0,name:"Value",propertyPath:"propertyPath",propertyName:"Property Path"}],drawBackground:function(node,target){return target+"'s\n"+node.properties["Property Path"]}},object),graph_node_1.registerNode({name:"Set Property",description:"Sets the property of the current node to the input value.",path:"properties/setproperty",ctor:Object,functionRef:function(node,target,scene){var split=node.properties["Property Path"].split("."),effectiveProperty=graph_node_1.GraphNode.GetEffectiveProperty(target,node.properties["Property Path"]),property=effectiveProperty[split[split.length-1]],input=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1),property instanceof babylonjs_1.Color3||property instanceof babylonjs_1.Color4);return graph_node_1.GraphNode.GetConstructorName(input)!==graph_node_1.GraphNode.GetConstructorName(property)?node.getInputData(1):effectiveProperty[split[split.length-1]]=input},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"In",type:void 0}],properties:[{name:"Property Path",type:"string",defaultValue:"name"},{name:"Target Path",type:"string",defaultValue:"Self"}],outputs:[{type:void 0,name:"Value",propertyPath:"propertyPath",propertyName:"Property Path"}],drawBackground:function(node,target){return target+"'s\n"+node.properties["Property Path"]}},object),graph_node_1.registerNode({name:"Variable",description:"Sets a variable node taken from the avaialable node variables.",path:"properties/variable",ctor:Object,functionRef:function(node){node.graph.variables=node.graph.variables||[];var v=node.graph.variables.find(function(v){return v.name===node.properties.Variable});if(v){var i=node.getInputData(1);return null!=i&&(v.value=i),graph_node_1.GraphNode.nodeToOutput(v.value)}console.warn('No variable found for name "'+node.properties.Variable+'"')},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Set Value",type:void 0}],outputs:[{name:"Get Value",type:void 0}],properties:[{name:"Variable",type:"string",defaultValue:""}],widgets:[{name:"Variable",type:"combo",value:"None",callback:function(v,g,n){return n.properties.Variable=v},options:{onInstanciate:function(n,w){return w.value=n.properties.Variable},values:function(w,n){return n.graph.variables.map(function(v){return v.name})}}}],drawBackground:function(node){return node.properties.Variable}},object)}}),$__System.registerDynamic("1d",["f","c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllTransformsNodes=function(object){graph_node_1.registerNode({name:"Transform",description:"Gets the current transformation of the node",path:"node/transform",ctor:babylonjs_1.AbstractMesh,functionRef:function(node,target){var position=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1),!1),rotation=graph_node_1.GraphNode.nodeToOutput(node.getInputData(2),!1),scaling=graph_node_1.GraphNode.nodeToOutput(node.getInputData(3),!1);return position&&target.position&&target.position.copyFrom(position),rotation&&target.rotation&&target.rotation.copyFrom(rotation),scaling&&target.scaling&&target.scaling.copyFrom(scaling),node.setOutputData(1,rotation?rotation.asArray():target.rotation),node.setOutputData(2,scaling?scaling.asArray():target.scaling),position||target.position},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Position",type:"vec3"},{name:"Rotation",type:"vec3"},{name:"Scaling",type:"vec3"}],outputs:[{name:"Position",type:"vec3"},{name:"Rotation",type:"vec3"},{name:"Scaling",type:"vec3"}],drawBackground:function(node,target){return target}},object),graph_node_1.registerNode({name:"Set Parent",description:"Sets the new parent of the node",path:"node/setparent",ctor:babylonjs_1.Node,functionRef:function(node,target,scene){var parent=node.getInputData(1)||target;parent!==node.graph.scriptObject?node.graph.scriptObject.parent=parent:node.graph.scriptObject.parent=null},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Parent",type:"node"}],properties:[{name:"Target Path",type:"string",defaultValue:"Self"}]},object)}}),$__System.registerDynamic("1e",["f","c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllPointerNodes=function(object){var checkPointerEvent=function(node,target,scene,ev,type){if(ev.type===type)return scene.pick(scene.pointerX,scene.pointerY).pickedMesh===target};graph_node_1.registerNode({name:"Pointer Down",description:"Triggers on the node has been clicked.",path:"events/pointerdown",ctor:babylonjs_1.AbstractMesh,functionRef:function(node,target,scene){node.store.observer=node.store.observer||scene.onPointerObservable.add(function(ev){checkPointerEvent(0,target,scene,ev,babylonjs_1.PointerEventTypes.POINTERDOWN)&&node.triggerSlot(0)})},outputs:[{name:"Clicked",type:litegraph_js_1.LiteGraph.EVENT}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)}},object),graph_node_1.registerNode({name:"Pointer Move",description:"Triggers on the pointer moves on the node.",path:"events/pointermove",ctor:babylonjs_1.AbstractMesh,functionRef:function(node,target,scene){node.store.observer=node.store.observer||scene.onPointerObservable.add(function(ev){checkPointerEvent(0,target,scene,ev,babylonjs_1.PointerEventTypes.POINTERMOVE)&&node.triggerSlot(0)})},outputs:[{name:"Moved",type:litegraph_js_1.LiteGraph.EVENT}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)}},object),graph_node_1.registerNode({name:"Pointer Up",description:"Triggers on the pointer is up on the node.",path:"events/pointerup",ctor:babylonjs_1.AbstractMesh,functionRef:function(node,target,scene){node.store.observer=node.store.observer||scene.onPointerObservable.add(function(ev){checkPointerEvent(0,target,scene,ev,babylonjs_1.PointerEventTypes.POINTERUP)&&node.triggerSlot(0)})},outputs:[{name:"Up",type:litegraph_js_1.LiteGraph.EVENT}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)}},object),graph_node_1.registerNode({name:"Pointer Over",description:"Triggers on the pointer is over the node.",path:"events/pointerover",ctor:babylonjs_1.AbstractMesh,functionRef:function(node,target,scene){node.store.wasOver=node.store.wasOver||!1,node.store.observer=node.store.observer||scene.onPointerObservable.add(function(ev){node.store.wasOver=checkPointerEvent(0,target,scene,ev,babylonjs_1.PointerEventTypes.POINTERMOVE)}),node.store.wasOver&&node.triggerSlot(0)},outputs:[{name:"Over",type:litegraph_js_1.LiteGraph.EVENT}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)}},object),graph_node_1.registerNode({name:"Pointer Out",description:"Triggers on the pointer is out of the node.",path:"events/pointerout",ctor:babylonjs_1.AbstractMesh,functionRef:function(node,target,scene){node.store.wasOver=node.store.wasOver||!1,node.store.observer=node.store.observer||scene.onPointerObservable.add(function(ev){var isOver=node.store.wasOver;node.store.wasOver=checkPointerEvent(0,target,scene,ev,babylonjs_1.PointerEventTypes.POINTERMOVE),isOver&&!node.store.wasOver&&node.triggerSlot(0)})},outputs:[{name:"Out",type:litegraph_js_1.LiteGraph.EVENT}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)}},object)}}),$__System.registerDynamic("1f",["f","c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllKeyboardNodes=function(object){var checkKeyboardEvent=function(node,target,ev,type){if(ev.type===type){var hasControl=ev.event.ctrlKey||ev.event.metaKey,isKey=ev.event.key.toLowerCase()===node.properties.Key.toLowerCase();return isKey&&!node.properties["Check Control"]||isKey&&node.properties["Check Control"]&&hasControl}};graph_node_1.registerNode({name:"Keyboard Down",description:"Triggers on a keyboard key is down",path:"events/keyboarddown",ctor:babylonjs_1.Node,functionRef:function(node,target,scene){node.store.wasDown=node.store.wasDown||!1,node.store.observer=node.store.observer||scene.onKeyboardObservable.add(function(ev){node.store.wasDown=checkKeyboardEvent(node,0,ev,babylonjs_1.KeyboardEventTypes.KEYDOWN)}),node.store.wasDown&&node.triggerSlot(0)},outputs:[{name:"Key Down",type:litegraph_js_1.LiteGraph.EVENT}],properties:[{name:"Key",type:"string",defaultValue:"a"},{name:"Check Control",type:"boolean",defaultValue:!1}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)},drawBackground:function(node){return node.properties.Key}},object),graph_node_1.registerNode({name:"Keyboard Up",description:"Triggers on a keyboard key is up",path:"events/keyboardup",ctor:babylonjs_1.Node,functionRef:function(node,target,scene){node.store.observer=node.store.observer||scene.onKeyboardObservable.add(function(ev){checkKeyboardEvent(node,0,ev,babylonjs_1.KeyboardEventTypes.KEYUP)&&node.triggerSlot(0)})},outputs:[{name:"Key Up",type:litegraph_js_1.LiteGraph.EVENT}],properties:[{name:"Key",type:"string",defaultValue:"a"},{name:"Check Control",type:"boolean",defaultValue:!1}],onStop:function(node,target,scene){node.store.observer&&scene.onPointerObservable.remove(node.store.observer)}},object)}}),$__System.registerDynamic("20",["f","c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllAbstractMeshNodes=function(object){graph_node_1.registerNode({name:"Get Mesh Direction",description:"Returns the current direction of the node.",path:"node/getdirection",ctor:babylonjs_1.AbstractMesh,functionRef:"getDirection",inputs:[{name:"localAxis",type:"vec3"}],outputs:[{name:"vec3",type:"vec3"}],parameters:[{inputName:"localAxis",type:"vec3"}]},object),graph_node_1.registerNode({name:"Set Mesh Direction",description:"Sets the current direction of the node.",path:"node/setdirection",ctor:babylonjs_1.AbstractMesh,functionRef:"setDirection",inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"localAxis",type:"vec3"}],parameters:[{inputName:"localAxis",type:"vec3"}]},object)}}),$__System.registerDynamic("21",["f","c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllAnimationNodes=function(object){graph_node_1.registerNode({name:"Play Animations",description:"Plays the animations of the current node.",path:"animation/play",ctor:babylonjs_1.Node,functionRef:function(node,target,scene){node.store.playing||(node.store.playing=!0,scene.beginAnimation(target,node.properties.From,node.properties.To,node.properties.Loop,node.properties.Speed,function(){node.triggerSlot(0),node.store.playing=!1},null,null,null,function(){return node.triggerSlot(1)}))},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT}],properties:[{name:"Target Path",type:"string",defaultValue:"Self"},{name:"From",type:"number",defaultValue:0},{name:"To",type:"number",defaultValue:60},{name:"Speed",type:"number",defaultValue:1},{name:"Loop",type:"boolean",defaultValue:!1}],outputs:[{name:"On End",type:litegraph_js_1.LiteGraph.EVENT},{name:"On Loop",type:litegraph_js_1.LiteGraph.EVENT}],widgets:[{type:"number",name:"From",value:0,callback:function(v,g,n){return n.properties.From=v}},{type:"number",name:"To",value:60,callback:function(v,g,n){return n.properties.To=v}},{type:"number",name:"Speed",value:0,callback:function(v,g,n){return n.properties.Speed=v}},{type:"toggle",name:"Loop",value:!1,callback:function(v,g,n){return n.properties.Loop=v}}],drawBackground:function(node,target){return target}},object),graph_node_1.registerNode({name:"Stop Animations",description:"Stops the currently playing animations of the current node.",path:"animation/stop",ctor:babylonjs_1.Node,functionRef:function(node,target,scene){scene.stopAnimation(target)},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT}],properties:[{name:"Target Path",type:"string",defaultValue:"Self"}],drawBackground:function(node,target){return target}},object),graph_node_1.registerNode({name:"Interpolate Value",description:"Interpolates the ",path:"animation/interpolatevalue",ctor:babylonjs_1.Node,functionRef:function(node,target,scene){if(!node.store.playing){node.store.playing=!0;var targetValue=graph_node_1.GraphNode.nodeToOutput(node.getInputData(1));if(void 0!==targetValue){var propertyPath=node.properties["Property Path"],property=graph_node_1.GraphNode.GetProperty(target,propertyPath),ctor1=graph_node_1.GraphNode.GetConstructorName(property).toLowerCase(),ctor2=graph_node_1.GraphNode.GetConstructorName(targetValue).toLowerCase();if(ctor1===ctor2){var animationType=babylonjs_1.Animation.ANIMATIONTYPE_FLOAT;switch(ctor1){case"vector2":animationType=babylonjs_1.Animation.ANIMATIONTYPE_VECTOR2;break;case"vector3":animationType=babylonjs_1.Animation.ANIMATIONTYPE_VECTOR3;break;case"color3":animationType=babylonjs_1.Animation.ANIMATIONTYPE_COLOR3}var animation=new babylonjs_1.Animation(propertyPath,propertyPath,60,animationType,babylonjs_1.Animation.ANIMATIONLOOPMODE_CONSTANT,!1);animation.setKeys([{frame:0,value:property.clone?property.clone():property},{frame:60*node.properties["Duration (seconds)"],value:targetValue}]),scene.stopAnimation(target),scene.beginDirectAnimation(target,[animation],0,60,!1,node.properties.Speed,function(){return node.store.playing=!1})}else console.warn('Cannot interpolate values of two different types. property: "'+ctor1+'", target value: "'+ctor2+'"')}}},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Target Value",type:"number,vec2,vec3,col3"}],properties:[{name:"Target Path",type:"string",defaultValue:"Self"},{name:"Property Path",type:"string",defaultValue:"name"},{name:"Speed",type:"number",defaultValue:1},{name:"Duration (seconds)",type:"number",defaultValue:1}],outputs:[{name:"Current Value",type:"number,vec2,vec3,vec4,col3,col4"}],widgets:[{type:"number",name:"Speed",value:1,callback:function(v,g,n){return n.properties.Speed=v}},{type:"number",name:"Duration (seconds)",value:1,callback:function(v,g,n){return n.properties["Duration (seconds)"]=v}}],drawBackground:function(node,target){return target+"'s "+node.properties["Property Path"]}},object)}}),$__System.registerDynamic("22",["c","13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("c"),graph_node_1=$__require("13");exports.registerAllSoundNodes=function(object){var getSound=function(node,scene){var input=node.getInputData(1);return scene.getSoundByName(input||node.properties["Sound Name"])};graph_node_1.registerNode({name:"Play Sound",description:"Plays the given sound",path:"sound/play",ctor:Object,functionRef:function(node,target,scene){var sound=getSound(node,scene);sound&&(sound.loop=node.properties.Loop,sound.play())},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Sound Name",type:"string"}],properties:[{name:"Sound Name",type:"string",defaultValue:"None"},{name:"Loop",type:"boolean",defaultValue:!1}],widgets:[{type:"toggle",name:"Loop",value:!1,callback:function(v,g,n){return n.properties.Loop=v},options:{onInstanciate:function(n,w){w.value=n.properties.Loop}}}],drawBackground:function(node){return node.properties["Sound Name"]}},object),graph_node_1.registerNode({name:"Pause Sound",description:"Pauses the given sound",path:"sound/pause",ctor:Object,functionRef:function(node,target,scene){var sound=getSound(node,scene);sound&&sound.pause()},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Sound Name",type:"string"}],properties:[{name:"Sound Name",type:"string",defaultValue:"None"}],drawBackground:function(node){return node.properties["Sound Name"]}},object),graph_node_1.registerNode({name:"Stop Sound",description:"Stops the given sound",path:"sound/stop",ctor:Object,functionRef:function(node,target,scene){var sound=getSound(node,scene);sound&&sound.stop()},inputs:[{name:"Execute",type:litegraph_js_1.LiteGraph.EVENT},{name:"Sound Name",type:"string"}],properties:[{name:"Sound Name",type:"string",defaultValue:"None"}],drawBackground:function(node){return node.properties["Sound Name"]}},object)}}),$__System.registerDynamic("13",["f","10"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__values=exports&&exports.__values||function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=exports&&exports.__read||function(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),types_1=$__require("10");exports.registerNode=function(description,object){var _a;(!object||object instanceof description.ctor)&&GraphNode.RegisterNode(description.path,((_a=function(_super){function class_1(){var _this=_super.call(this,description)||this;return _this.title=description.name,_this.desc=description.description,_this}return __extends(class_1,_super),class_1}(GraphNode)).Title=description.name,_a.Desc=description.description,_a))};var GraphNode=function(_super){function GraphNode(description){var _this=_super.call(this)||this;return _this.description=description,_this._propertiesOrder=[],_this._inputsOrder=[],_this._parametersOrder=[],_this._outputsOrder=[],description.properties&&description.properties.forEach(function(i){switch(i.type){case"number":case"string":case"boolean":_this._propertiesOrder.push(GraphNode.commonToCommon),_this.addProperty(i.name,i.defaultValue);break;case"vec2":_this._propertiesOrder.push(GraphNode.vec2ToVector2),_this.addProperty(i.name,[0,0]);break;case"vec3":_this._propertiesOrder.push(GraphNode.vec3ToVector3),_this.addProperty(i.name,[0,0,0]);break;case"vec4":_this._propertiesOrder.push(GraphNode.vec4ToVector4),_this.addProperty(i.name,[0,0,0,0])}}),description.inputs&&description.inputs.forEach(function(i){switch(i.type){case"number":case"string":_this._inputsOrder.push(GraphNode.commonToCommon);break;case"vec2":_this._inputsOrder.push(GraphNode.vec2ToVector2);break;case"vec3":_this._inputsOrder.push(GraphNode.vec3ToVector3);break;case"vec4":_this._inputsOrder.push(GraphNode.vec4ToVector4);break;case"col3":_this._inputsOrder.push(GraphNode.col3ToColor3);break;case"col4":_this._inputsOrder.push(GraphNode.col4ToColor4);break;default:_this._inputsOrder.push(GraphNode.inputToNode)}_this.addInput(i.name,i.type)}),description.parameters&&description.parameters.forEach(function(p){switch(p.type){case"number":case"string":_this._parametersOrder.push(GraphNode.commonToCommon);break;case"vec2":_this._parametersOrder.push(GraphNode.vec2ToVector2);break;case"vec3":_this._parametersOrder.push(GraphNode.vec3ToVector3);break;case"vec4":_this._parametersOrder.push(GraphNode.vec4ToVector4);break;case"col3":_this._parametersOrder.push(GraphNode.col3ToColor3);break;case"col4":_this._parametersOrder.push(GraphNode.col4ToColor4)}}),description.outputs&&description.outputs.forEach(function(o){switch(o.type){case"number":case"string":_this._outputsOrder.push(GraphNode.commonToCommon);break;case"vec2":_this._outputsOrder.push(GraphNode.vector2ToVec2);break;case"vec3":_this._outputsOrder.push(GraphNode.vector3ToVec3);break;case"vec4":_this._outputsOrder.push(GraphNode.vector4ToVec4);break;case"col3":_this._outputsOrder.push(GraphNode.color3ToCol3);break;case"col4":_this._outputsOrder.push(GraphNode.color4ToCol4);break;default:_this._outputsOrder.push(GraphNode.inputToNode)}_this.addOutput(o.name,o.type)}),description.widgets&&description.widgets.forEach(function(w){var widget=_this.addWidget(w.type,w.name,w.value,w.callback,w.options);"combo"===w.type&&(widget._value=w.value,Object.defineProperty(widget,"value",{get:function(){return widget._value},set:function(v){widget._value=v,w.callback&&w.callback(v,_this.graph,_this)}}))}),_this}return __extends(GraphNode,_super),GraphNode.prototype.onGetInputs=function(){return this.description&&this.description.onGetInputs().length>0?this.description.onGetInputs():[]},GraphNode.prototype.onGetOutputs=function(){return this.description&&this.description.onGetOutputs().length>0?this.description.onGetOutputs():[]},GraphNode.prototype.onExecute=function(){var e_1,_a,e_2,_b,e_3,_c,targetPath=this.properties["Target Path"],target=targetPath?GraphNode.GetTargetPath(targetPath,this.graph.scriptObject,this.graph.scriptScene):this.graph.scriptObject,functionRef=this.description.functionRef?"string"==typeof this.description.functionRef?GraphNode.GetProperty(target,this.description.functionRef):this.description.functionRef:null,inputs=[],parameters=[];if(this.description.inputs)try{for(var _d=__values(this.description.inputs.entries()),_e=_d.next();!_e.done;_e=_d.next()){var _f=__read(_e.value,2),index=_f[0],input=_f[1],data=this.getInputData(index);if(inputs.push({name:input.name,data:data}),data&&input.propertyPath){var split=input.propertyPath.split(".");GraphNode.GetEffectiveProperty(target,input.propertyPath)[split[split.length-1]]=GraphNode.nodeToOutput(data,"col3"===input.type||"col4"===input.type)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_e&&!_e.done&&(_a=_d.return)&&_a.call(_d)}finally{if(e_1)throw e_1.error}}if(this.description.parameters){var _loop_1=function(index,parameter){if(parameter.inputName){var input=inputs.find(function(i){return i.name===parameter.inputName});if(!input&&!parameter.optional)return{value:console.warn('Warning: calling "'+this_1.description.functionRef+'", input "'+input.name+'" is mandatory')};parameters.push(this_1._parametersOrder[index](input.data))}},this_1=this;try{for(var _g=__values(this.description.parameters.entries()),_h=_g.next();!_h.done;_h=_g.next()){var _j=__read(_h.value,2),state_1=_loop_1(index=_j[0],_j[1]);if("object"==typeof state_1)return state_1.value}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_h&&!_h.done&&(_b=_g.return)&&_b.call(_g)}finally{if(e_2)throw e_2.error}}}var result=functionRef?"string"==typeof this.description.functionRef?functionRef.apply(target,parameters):functionRef(this,target,this.graph.scriptScene):null;if(this.description.outputs){var _loop_2=function(index,output){if(this_2.description.functionRef&&0===index)return this_2.setOutputData(index,this_2._outputsOrder[index](result)),"continue";if(output.propertyPath){if(output.propertyName){var property=GraphNode.GetProperty(target,this_2.properties[output.propertyName]);this_2.setOutputData(index,this_2._outputsOrder[index](property))}else{property=GraphNode.GetProperty(target,output.propertyPath);this_2.setOutputData(index,this_2._outputsOrder[index](property))}return"continue"}if(output.propertyName)return this_2.setOutputData(index,this_2.properties[output.propertyName]),"continue";if(output.inputName){var input=inputs.find(function(i){return i.name===output.inputName});return this_2.setOutputData(index,input.data),"continue"}},this_2=this;try{for(var _k=__values(this.description.outputs.entries()),_l=_k.next();!_l.done;_l=_k.next()){var _m=__read(_l.value,2);_loop_2(index=_m[0],_m[1])}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_l&&!_l.done&&(_c=_k.return)&&_c.call(_k)}finally{if(e_3)throw e_3.error}}}},GraphNode.prototype.onDrawBackground=function(ctx,graph,canvas,text){this.description.drawBackground&&_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.description.drawBackground(this,this.properties["Target Path"]))},GraphNode.prototype.onKeyUp=function(ev){46===ev.keyCode&&this.graph.remove(this)},GraphNode.prototype.isInputValid=function(value){return null!=value},GraphNode.GetProperty=function(object,path){for(var split=path.split("."),i=0;i<split.length;i++)object=object[split[i]];return object},GraphNode.GetEffectiveProperty=function(object,path){for(var split=path.split("."),i=0;i<split.length-1;i++)object=object[split[i]];return object},GraphNode.GetConstructorName=function(obj){var ctrName=null!=obj&&obj.constructor?obj.constructor.name:"";return""===ctrName&&(ctrName=typeof obj),ctrName},GraphNode.GetTargetPath=function(path,target,scene){return"Self"===path?target:"Scene"===path?scene:scene.getNodeByName(path)},GraphNode.inputToNode=function(value){switch(GraphNode.GetConstructorName(value).toLowerCase()){case"number":case"string":return value;case"vector2":case"vector3":case"vector4":return value.asArray();case"color3":case"color4":return value.asArray();default:return value}},GraphNode.nodeToOutput=function(value,asColor){switch(GraphNode.GetConstructorName(value).toLowerCase()){case"number":case"string":return value;case"array":switch(value.length){case 2:return babylonjs_1.Vector2.FromArray(value);case 3:return asColor?babylonjs_1.Color3.FromArray(value):babylonjs_1.Vector3.FromArray(value);case 4:return asColor?babylonjs_1.Color4.FromArray(value):babylonjs_1.Vector4.FromArray(value)}default:return value}},GraphNode.commonToCommon=function(value){return value},GraphNode.vec2ToVector2=function(vec2){return babylonjs_1.Vector2.FromArray(vec2)},GraphNode.vector2ToVec2=function(vector2){return vector2.asArray()},GraphNode.vec3ToVector3=function(vec3){return babylonjs_1.Vector3.FromArray(vec3)},GraphNode.vector3ToVec3=function(vector3){return vector3.asArray()},GraphNode.vec4ToVector4=function(vec4){return babylonjs_1.Vector4.FromArray(vec4)},GraphNode.vector4ToVec4=function(vector4){return vector4.asArray()},GraphNode.col3ToColor3=function(col3){return babylonjs_1.Color3.FromArray(col3)},GraphNode.color3ToCol3=function(color3){return color3.asArray()},GraphNode.col4ToColor4=function(col4){return babylonjs_1.Color4.FromArray(col4)},GraphNode.color4ToCol4=function(color4){return color4.asArray()},GraphNode}(types_1.IGraphNode);exports.GraphNode=GraphNode}),$__System.registerDynamic("23",["13"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var graph_node_1=$__require("13");exports.registerAllSceneNodes=function(object){graph_node_1.registerNode({name:"Get Node By Name",description:"Returns the given node by name",path:"scene/getnodebyname",ctor:Object,functionRef:function(node,target,scene){return node.store.node=node.store.node||scene.getNodeByName(node.getInputData(0)||node.properties["Target Path"]),node.store.node},inputs:[{name:"Name",type:"string"}],properties:[{name:"Target Path",type:"string",defaultValue:"Self"}],outputs:[{name:"Mesh",type:"node"}],drawBackground:function(node,target){return target}},object),graph_node_1.registerNode({name:"Get Mesh By Name",description:"Returns the given mesh by name",path:"scene/getmeshbyname",ctor:Object,functionRef:function(node,target,scene){return node.store.mesh=node.store.mesh||scene.getMeshByName(node.getInputData(0)||node.properties["Target Path"]),node.store.mesh},inputs:[{name:"Name",type:"string"}],properties:[{name:"Target Path",type:"string",defaultValue:"Self"}],outputs:[{name:"Mesh",type:"node,mesh"}],drawBackground:function(node,target){return target}},object)}}),$__System.registerDynamic("24",["16","18","19","1b","1c","1d","1e","1f","20","21","22","23"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var types_1=$__require("16"),functions_1=$__require("18"),utils_1=$__require("19"),math_1=$__require("1b"),properties_1=$__require("1c"),transforms_1=$__require("1d"),pointer_1=$__require("1e"),keyboard_1=$__require("1f"),abstract_mesh_1=$__require("20"),animation_1=$__require("21"),sound_1=$__require("22"),scene_1=$__require("23");exports.registerAllNodes=function(object){types_1.registerAllTypeNodes(object),functions_1.registerAllFunctionNodes(object),utils_1.registerAllUtilsNodes(object),math_1.registerAllMathNodes(object),properties_1.registerAllPropertiesNodes(object),transforms_1.registerAllTransformsNodes(object),pointer_1.registerAllPointerNodes(object),keyboard_1.registerAllKeyboardNodes(object),abstract_mesh_1.registerAllAbstractMeshNodes(object),animation_1.registerAllAnimationNodes(object),sound_1.registerAllSoundNodes(object),scene_1.registerAllSceneNodes(object)}}),$__System.registerDynamic("17",["f","c","1a","15","13","24"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c");exports.LGraph=litegraph_js_1.LGraph,exports.LGraphCanvas=litegraph_js_1.LGraphCanvas,exports.LiteGraph=litegraph_js_1.LiteGraph,exports.LGraphGroup=litegraph_js_1.LGraphGroup;var extensions_1=$__require("1a"),extension_1=$__require("15"),graph_node_1=$__require("13");exports.GraphNode=graph_node_1.GraphNode;var nodes_list_1=$__require("24"),GraphExtension=function(_super){function GraphExtension(scene){var _this=_super.call(this,scene)||this;return _this.id="graph-editor",_this.assetsCaption="Graphs",_this.datas=null,_this}return __extends(GraphExtension,_super),GraphExtension.prototype.onGetAssets=function(){var data=this.onSerialize(),attached=[],unAttached=[];return data.graphs.forEach(function(s){if(data.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.graphId===s.id})}))return attached.push({name:s.name,data:s});unAttached.push({name:s.name,data:s})}),[{separator:"Attached"}].concat(attached).concat([{separator:"Unattached"}]).concat(unAttached)},GraphExtension.prototype.onRemoveAsset=function(asset){var data=asset.data,remove=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behaviorGraph)for(var links=o.metadata.behaviorGraph.metadatas,i=0;i<links.length;i++)links[i].graphId===data.id&&(links.splice(i,1),i--)})};remove([this.scene]),remove(this.scene.meshes),remove(this.scene.lights),remove(this.scene.cameras);var index=this.scene.metadata.behaviorGraphs.indexOf(data);-1!==index&&this.scene.metadata.behaviorGraphs.splice(index,1)},GraphExtension.prototype.onAddAsset=function(asset){this.scene.metadata.behaviorGraphs.push(asset.data)},GraphExtension.prototype.onDragAndDropAsset=function(targetMesh,asset){targetMesh.metadata=targetMesh.metadata||{},targetMesh.metadata.behaviorGraph||(targetMesh.metadata.behaviorGraph={node:targetMesh.name,metadatas:[]}),targetMesh.metadata.behaviorGraph.metadatas.push({graphId:asset.data.id,active:!0})},GraphExtension.prototype.onApply=function(data){var _this=this;this.datas=data,GraphExtension.RegisterNodes(),this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node&&d.metadatas.forEach(function(m){if(m.active){var graph=new litegraph_js_1.LGraph;graph.scriptObject=node,graph.scriptScene=_this.scene,graph_node_1.GraphNode.Loaded=!1;var effectiveData=_this.datas.graphs.find(function(s){return s.id===m.graphId});graph.configure(JSON.parse(JSON.stringify(effectiveData.graph))),graph.variables=effectiveData.variables,graph_node_1.GraphNode.Loaded=!0,_this.scene.onReadyObservable.addOnce(function(){_this.scene.onBeforeRenderObservable.add(function(){graph.runStep(1,!0)})})}})})},GraphExtension.prototype.onSerialize=function(){var result={graphs:this.scene.metadata&&this.scene.metadata.behaviorGraphs||[],nodes:[]},add=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behaviorGraph){var behavior=o.metadata.behaviorGraph;behavior.node=o instanceof babylonjs_1.Scene?"Scene":o instanceof Node?o.name:o.id,behavior.nodeId=o instanceof babylonjs_1.Scene?"Scene":o.id,result.nodes.push(behavior)}})};return add([this.scene]),add(this.scene.meshes),add(this.scene.lights),add(this.scene.cameras),result},GraphExtension.prototype.onLoad=function(data){var _this=this;if(!data.graphs){var oldData=data;data={graphs:[],nodes:[]},oldData.forEach(function(od){var node={node:od.node,nodeId:od.node,metadatas:[]};od.metadatas.forEach(function(m){var id=babylonjs_1.Tools.RandomId();data.graphs.push({name:m.name,id:id,graph:m.graph,variables:m.variables||[]}),node.metadatas.push({graphId:id,active:m.active})}),data.nodes.push(node)})}this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.behaviorGraphs=this.datas.graphs,this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node&&(node.metadata=node.metadata||{},node.metadata.behaviorGraph=d)})},GraphExtension.ClearNodes=function(){litegraph_js_1.LiteGraph.registered_node_types={}},GraphExtension.RegisterNodes=function(object){litegraph_js_1.LiteGraph.registered_node_types={},nodes_list_1.registerAllNodes(object)},GraphExtension}(extension_1.default);exports.default=GraphExtension,extensions_1.default.Register("BehaviorGraphExtension",GraphExtension)}),$__System.registerDynamic("10",["c"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("c"),IGraphNode=function(){function IGraphNode(){this.shape="round",this.pos=[60,20],this.size=[60,20],this.store={}}return IGraphNode.prototype.onConnectionsChange=function(type,slot,added,link,input){IGraphNode.Loaded&&this.mode!==litegraph_js_1.LiteGraph.NEVER&&(type===litegraph_js_1.LiteGraph.INPUT&&0===slot&&(added&&input.type===litegraph_js_1.LiteGraph.EVENT?this.mode=litegraph_js_1.LiteGraph.ON_TRIGGER:this.mode=litegraph_js_1.LiteGraph.ALWAYS),IGraphNode.SetColor(this))},IGraphNode.SetColor=function(node){switch(node.mode){case litegraph_js_1.LiteGraph.ALWAYS:node.color="#555",node.bgColor="#AAA";break;case litegraph_js_1.LiteGraph.ON_EVENT:node.color="#55A",node.bgColor="#44A";break;case litegraph_js_1.LiteGraph.ON_TRIGGER:node.color="#151",node.bgColor="#4A4";break;case litegraph_js_1.LiteGraph.NEVER:node.color="#A55",node.bgColor="#A44"}},IGraphNode.prototype.onDrawBackground=function(ctx,graph,canvas,text){if(!this.flags.collapsed&&text){ctx.font="14px Arial",ctx.fillStyle="grey",ctx.textAlign="center",ctx.shadowColor="#000000",ctx.shadowBlur=2;var measure=ctx.measureText(text);this.size[0]<=measure.width&&(this.size[0]=measure.width+100),ctx.fillText(text,.5*this.size[0],this.size[1]+15)}},IGraphNode.prototype.setNodeState=function(warning){warning?this.boxcolor="#ffff00":delete this.boxcolor},IGraphNode.RegisterNode=function(path,ctor){litegraph_js_1.LiteGraph.registered_node_types[path]||litegraph_js_1.LiteGraph.registerNodeType(path,ctor)},IGraphNode}();exports.IGraphNode=IGraphNode}),$__System.registerDynamic("a",["f","c","d","b","e","14","1a","17","10"],!0,function($__require,exports,module){"use strict";this||self;var extendStatics,__extends=exports&&exports.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__values=exports&&exports.__values||function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("f"),litegraph_js_1=$__require("c"),babylonjs_editor_1=$__require("d"),graph_tool_1=$__require("b"),graph_node_tool_1=$__require("e"),graph_node_creator_1=$__require("14"),extensions_1=$__require("1a"),graph_1=$__require("17");$__require("17");var types_1=$__require("10"),BehaviorGraphEditor=function(_super){function BehaviorGraphEditor(editor){var _this=_super.call(this,"Graph Editor")||this;return _this.editor=editor,_this.layout=null,_this.toolbar=null,_this.grid=null,_this.graphData=null,_this.graph=null,_this.extension=null,_this.node=null,_this.data=null,_this.datas=null,_this.selectedObjectObserver=null,_this.selectedAssetObserver=null,_this._savedState={},_this._variablesValues=[],_this._mouseMoveEvent=null,_this}return __extends(BehaviorGraphEditor,_super),BehaviorGraphEditor.OnLoaded=function(editor){editor.inspector.addTool(new graph_node_tool_1.default),editor.inspector.addTool(new graph_tool_1.default),graph_node_creator_1.default.Init()},BehaviorGraphEditor.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return document.removeEventListener("mousemove",this._mouseMoveEvent),this.playStop(!0),this.layout.element.destroy(),this.toolbar.element.destroy(),this.grid.element.destroy(),this.editor.core.onSelectObject.remove(this.selectedObjectObserver),this.editor.core.onSelectAsset.remove(this.selectedAssetObserver),this.node&&this.editor.inspector.setObject(this.node),[4,_super.prototype.close.call(this)];case 1:return _a.sent(),[2]}})})},BehaviorGraphEditor.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return this.layout=new babylonjs_editor_1.Layout(this.divElement.id),this.layout.panels=[{type:"top",resizable:!1,size:30,content:'<div id="GRAPH-EDITOR-TOOLBAR" style="width: 100%; height: 100%"></div>'},{type:"left",content:'<div id="GRAPH-EDITOR-LIST" style="width: 100%; height: 100%;"></div>',size:250,overflow:"auto",resizable:!0},{type:"main",content:'<canvas id="GRAPH-EDITOR-EDITOR" class="graphcanvas" style="width: 100%; height: 100%; position: absolute; top: 0;"></canvas>',resizable:!0}],this.layout.build(this.divElement.id),this.toolbar=new babylonjs_editor_1.Toolbar("GRAPH-EDITOR-TOOLBAR"),this.toolbar.items=[{id:"add-new",text:"Add New Graph",caption:"Add New Graph",img:"icon-add"},{type:"break"},{id:"paste",text:"Paste",caption:"Paste",img:"icon-export"},{type:"break"},{id:"play-stop",text:"Start / Stop",caption:"Start / Stop",img:"icon-play-game"},{type:"break"},{id:"import",text:"Import from...",caption:"Import from...",img:"icon-add"}],this.toolbar.onClick=function(id){return _this.toolbarClicked(id)},this.toolbar.right="No object selected",this.toolbar.helpUrl="https://doc.babylonjs.com/resources/using_grapheditor",this.toolbar.build("GRAPH-EDITOR-TOOLBAR"),this.grid=new babylonjs_editor_1.Grid("GRAPH-EDITOR-LIST",{toolbarReload:!1,toolbarSearch:!1,toolbarEdit:!1}),this.grid.columns=[{field:"name",caption:"Name",size:"80%",editable:{type:"string"}},{field:"active",caption:"Active",size:"20%",editable:{type:"checkbox"}}],this.grid.contextMenuItems=[{id:1,text:"Copy",icon:"icon-export"},{id:2,text:"Clone",icon:"icon-export"}],this.grid.onAdd=function(){return _this._importFrom([_this._getSerializedMetadatasFile()])},this.grid.onClick=function(ids){return _this.selectGraph(ids[0])},this.grid.onDelete=function(ids){return _this.delete(ids)},this.grid.onChange=function(id,value){return _this.change(id,value)},this.grid.onContextMenu=function(id,recid){return _this.gridContextMenuClicked(id,recid)},this.grid.build("GRAPH-EDITOR-LIST"),System.import("./node_modules/litegraph.js/css/litegraph.css"),this.graphData=new litegraph_js_1.LGraph,this.graphData.onStopEvent=function(){_this.graphData._nodes.forEach(function(n){n.description&&n.description.onStop&&n.description.onStop(n,_this.graphData.scriptObject,_this.graphData.scriptScene),n.store={}})},this.graphData.onNodeAdded=function(node){node.shape="round"},this.graph=new litegraph_js_1.LGraphCanvas("#GRAPH-EDITOR-EDITOR",this.graphData),this.graph.canvas.classList.add("ctxmenu"),document.addEventListener("mousemove",this._mouseMoveEvent=function(ev){_this.data&&(_this.data.graph=JSON.parse(JSON.stringify(_this.graphData.serialize())),_this.data.variables=_this.graphData.variables)}),this.graph.canvas.addEventListener("click",function(){var canvasPos=_this.graph.convertEventToCanvas(event);if(!_this.graphData.getNodeOnPos(canvasPos[0],canvasPos[1])){var group=_this.graphData.getGroupOnPos(canvasPos[0],canvasPos[1]);return _this.editor.inspector.setObject(group||_this.graph)}}),this.graph.render_canvas_border=!1,this.graph.render_execution_order=!0,this.graph.onNodeSelected=function(node){return _this.editor.inspector.setObject(node)},this.graph.showSearchBox=function(){},this.graph.processContextMenu=function(node,event){if(!node){var group_1=_this.graphData.getGroupOnPos(event.canvasX,event.canvasY);return group_1?babylonjs_editor_1.ContextMenu.Show(event,{remove:{name:"Remove",callback:function(){!1!==group_1.removable&&_this.graphData.remove(group_1)}}}):(graph_node_creator_1.default.OnConfirmSelection=function(id){var node="group"===id?new litegraph_js_1.LGraphGroup:litegraph_js_1.LiteGraph.createNode(id);node&&(node.pos=_this.graph.convertEventToCanvas(event),node.size[0]<100&&(node.size[0]=100),node.widgets&&(node.size[1]+=25*node.widgets.length),node.color="#555",node.bgColor="#AAA",_this.graphData.add(node),graph_node_creator_1.default.Hide())},graph_node_creator_1.default.Show())}babylonjs_editor_1.ContextMenu.Show(event,{clone:{name:"Clone",callback:function(){var clone=litegraph_js_1.LiteGraph.createNode(node.type);clone.pos=[node.pos[0]+10,node.pos[1]+10],clone.properties=babylonjs_editor_1.Tools.Clone(node.properties),clone.color="#555",clone.bgColor="#AAA",clone.widgets&&(clone.size[1]+=25*node.widgets.length,clone.widgets.forEach(function(w){return w.options&&w.options.onInstanciate&&w.options.onInstanciate(node,w)})),_this.graphData.add(clone)}},remove:{name:"Remove",callback:function(){!1!==node.removable&&_this.graphData.remove(node)}}})},graph_1.default.ClearNodes(),graph_1.default.RegisterNodes(),graph_node_creator_1.default.InitItems(),this.editor.core.scene.metadata=this.editor.core.scene.metadata||{},this.editor.core.scene.metadata.behaviorGraphs=this.editor.core.scene.metadata.behaviorGraphs||[],this.selectedObjectObserver=this.editor.core.onSelectObject.add(function(data){return _this.objectSelected(data)}),this.selectedAssetObserver=this.editor.core.onSelectAsset.add(function(data){return _this.assetSelected(data)}),this.objectSelected(this.editor.core.currentSelectedObject),this.extension=extensions_1.default.RequestExtension(this.editor.core.scene,"BehaviorGraphExtension"),this.editor.assets.addTab(this.extension),[2]})})},BehaviorGraphEditor.prototype.onShow=function(){this.onResize()},BehaviorGraphEditor.prototype.onResize=function(){this.layout.element.resize();var size=this.layout.getPanelSize("main");this.graph.resize(size.width,size.height)},BehaviorGraphEditor.prototype.toolbarClicked=function(id){switch(id){case"add-new":this.add();break;case"paste":if(BehaviorGraphEditor._CopiedGraph){var graphs=this.editor.core.scene.metadata.behaviorGraphs,clonedGraph=Object.assign({},graphs.find(function(g){return g.id===BehaviorGraphEditor._CopiedGraph.graphId}));clonedGraph.id=babylonjs_1.Tools.RandomId(),graphs.push(clonedGraph);var clone=Object.assign({},BehaviorGraphEditor._CopiedGraph);clone.graphId=clonedGraph.id,this.datas.metadatas.push(clone),this.editor.assets.refresh(this.extension.id),this.objectSelected(this.node)}break;case"play-stop":this.playStop();break;case"import":this._importFrom()}},BehaviorGraphEditor.prototype.gridContextMenuClicked=function(id,recid){switch(id){case 1:BehaviorGraphEditor._CopiedGraph=this.datas.metadatas[recid];break;case 2:var graphs=this.editor.core.scene.metadata.behaviorGraphs,metadata_1=this.datas.metadatas[recid],clonedGraph=Object.assign({},graphs.find(function(g){return g.id===metadata_1.graphId}));clonedGraph.id=babylonjs_1.Tools.RandomId(),clonedGraph.name+=" Cloned",graphs.push(clonedGraph);var clone=Object.assign({},this.datas.metadatas[recid]);clone.graphId=clonedGraph.id,this.datas.metadatas.push(clone),this.editor.assets.refresh(this.extension.id),this.objectSelected(this.node)}},BehaviorGraphEditor.prototype.assetSelected=function(asset){if(this.node=null,!asset)return this.objectSelected(null);asset.graph&&(this.layout.hidePanel("left"),this.toolbar.updateItem("paste",{hidden:!0}),this.toolbar.updateItem("play-stop",{hidden:!0}),this.onResize(),this.datas={node:"Unknown",nodeId:"Unknown",metadatas:[{active:!0,graphId:asset.id}]},this.selectGraph(0),this.layout.unlockPanel("left"),this.layout.unlockPanel("main"))},BehaviorGraphEditor.prototype.objectSelected=function(node){var _this=this;if(!(node&&(node instanceof babylonjs_1.Node||node instanceof babylonjs_1.Scene)))return this.layout.lockPanel("left"),this.layout.lockPanel("main","No Node Selected"),this.toolbar.updateItem("paste",{hidden:!0}),void this.toolbar.updateItem("play-stop",{hidden:!0});this.playStop(!0),this.node=node,node.metadata=node.metadata||{},this.datas=node.metadata.behaviorGraph,this.datas||(this.datas=node.metadata.behaviorGraph={node:node instanceof babylonjs_1.Scene?"Scene":node.name,nodeId:node instanceof babylonjs_1.Scene?"Scene":node.id,metadatas:[]}),this.data=null,this.grid.element.clear(),this.graphData.clear(),this.graphData.scriptObject=node,this.graphData.scriptScene=this.editor.core.scene;var graphs=this.editor.core.scene.metadata.behaviorGraphs;this.datas.metadatas.forEach(function(d,index){var graph=graphs.find(function(s){return s.id===d.graphId});_this.grid.addRecord({recid:index,name:graph.name,active:d.active})}),this.grid.element.refresh(),this.datas.metadatas.length>0&&(this.selectGraph(0),this.grid.select([0])),this.layout.showPanel("left"),this.onResize(),this._updateToolbarText(),this.layout.unlockPanel("left"),0===this.datas.metadatas.length?this.layout.lockPanel("main","No Graph Selected"):this.layout.unlockPanel("main"),this.toolbar.updateItem("paste",{hidden:!1}),this.toolbar.updateItem("play-stop",{hidden:!1})},BehaviorGraphEditor.prototype.selectGraph=function(index){var _this=this,graphs=this.editor.core.scene.metadata.behaviorGraphs;this.data=graphs.find(function(s){return s.id===_this.datas.metadatas[index].graphId}),this.playStop(!0),graph_1.default.ClearNodes(),graph_1.default.RegisterNodes(this.node),this.graphData.clear(),types_1.IGraphNode.Loaded=!1,this.graphData.configure(JSON.parse(JSON.stringify(this.data.graph))),this.graphData.variables=this.data.variables||[],this.graphData._nodes.forEach(function(n){n.widgets&&n.widgets.forEach(function(w){return w.options&&w.options.onInstanciate&&w.options.onInstanciate(n,w)})}),types_1.IGraphNode.Loaded=!0,this._updateToolbarText()},BehaviorGraphEditor.prototype.add=function(){return __awaiter(this,void 0,void 0,function(){var name,data;return __generator(this,function(_a){switch(_a.label){case 0:return graph_1.default.ClearNodes(),graph_1.default.RegisterNodes(this.node),[4,babylonjs_editor_1.Dialog.CreateWithTextInput("Graph Name")];case 1:return name=_a.sent(),data={name:name,id:babylonjs_1.Tools.RandomId(),graph:JSON.parse(JSON.stringify((new litegraph_js_1.LGraph).serialize())),variables:[]},this.editor.core.scene.metadata.behaviorGraphs.push(data),this.node?(this.datas.metadatas.push({active:!0,graphId:data.id}),this.grid.addRow({recid:this.datas.metadatas.length-1,name:data.name,active:!0}),this.grid.selectNone(),this.grid.select([this.datas.metadatas.length-1]),this.selectGraph(this.datas.metadatas.length-1),this.editor.graph.configure()):this.assetSelected(data),this.layout.unlockPanel("main"),this.editor.assets.refresh(this.extension.id),[2]}})})},BehaviorGraphEditor.prototype.delete=function(ids){var _this=this;this.playStop(!0);var offset=0;ids.forEach(function(id){_this.datas.metadatas.splice(id-offset,1),offset++}),this.objectSelected(this.node),this.editor.assets.refresh(this.extension.id),this.editor.graph.configure()},BehaviorGraphEditor.prototype.change=function(id,value){var _this=this;"string"==typeof value?(this.editor.core.scene.metadata.behaviorGraphs.find(function(s){return s.id===_this.datas.metadatas[id].graphId}).name=value,this._updateToolbarText(),this.editor.assets.refresh(this.extension.id)):this.datas.metadatas[id].active=value},BehaviorGraphEditor.prototype.playStop=function(stop){var _this=this;if(void 0===stop&&(stop=!1),stop||this.graphData.status===litegraph_js_1.LGraph.STATUS_RUNNING){if(this.node){for(var obj in this.editor.core.scene.stopAnimation(this.node),this._savedState.material&&(babylonjs_1.SerializationHelper.Parse(function(){return _this.node.material},this._savedState.material,this.editor.core.scene,"file:"),delete this._savedState.material),this._savedState)this.node[obj]=this._savedState[obj];this._variablesValues.forEach(function(v,index){return _this.graphData.variables[index].value=v})}this._savedState={},this._variablesValues=[],this.graphData.stop(),this.toolbar.updateItem("play-stop",{img:"icon-play-game",checked:!1}),this.editor.core.disableObjectSelection=!1}else{this.node.position&&(this._savedState.position=this.node.position.clone()),this.node.rotation&&(this._savedState.rotation=this.node.rotation.clone()),this.node.scaling&&(this._savedState.scaling=this.node.scaling.clone()),this.node.rotationQuaternion&&(this._savedState.rotationQuaternion=this.node.rotationQuaternion.clone()),this.node.material&&(this._savedState.material=this.node.material.serialize()),this._savedState.parent=this.node.parent,Object.keys(this.node).forEach(function(k){if("_"!==k[0]){var type=typeof _this.node[k];if("number"!==type&&"string"!==type&&"boolean"!==type){var ctor=babylonjs_editor_1.Tools.GetConstructorName(_this.node[k]);"Vector3"!==ctor&&"Vector3"!==ctor&&"Vector4"!==ctor&&"Color3"!==ctor&&"Color4"!==ctor||(_this._savedState[k]=_this.node[k].clone())}else _this._savedState[k]=_this.node[k]}}),this.graphData.variables.forEach(function(v){return _this._variablesValues.push(v.value)}),this.graphData._nodes.forEach(function(n){}),this.graphData.start(),this.toolbar.updateItem("play-stop",{img:"icon-error",checked:!0}),this.editor.core.disableObjectSelection=!0}},BehaviorGraphEditor.prototype._updateToolbarText=function(){this.toolbar.element.right="<h2>"+(this.data?this.data.name:"")+'</h2> Attached to "'+(this.node instanceof babylonjs_1.Scene?"Scene":this.node?this.node.name:"")+'"',this.toolbar.element.render()},BehaviorGraphEditor.prototype._getSerializedMetadatasFile=function(){var result={customMetadatas:{BehaviorGraphExtension:this.extension.onSerialize()}};return babylonjs_editor_1.Tools.CreateFile(babylonjs_editor_1.Tools.ConvertStringToUInt8Array(JSON.stringify(result)),"editorproject")},BehaviorGraphEditor.prototype._importFrom=function(files){return __awaiter(this,void 0,void 0,function(){var importFromFile,_loop_1,this_1,files_1,files_1_1,f,e_1_1,e_1,_a,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:return importFromFile=!1,files?[3,2]:(importFromFile=!0,[4,babylonjs_editor_1.Tools.OpenFileDialog()]);case 1:files=_b.sent(),_b.label=2;case 2:_loop_1=function(f){var content,project,metadatas,graphs,picker;return __generator(this,function(_a){switch(_a.label){case 0:return"editorproject"!==babylonjs_editor_1.Tools.GetFileExtension(f.name)?[2,"continue"]:[4,babylonjs_editor_1.Tools.ReadFileAsText(f)];case 1:return content=_a.sent(),(project=JSON.parse(content)).customMetadatas&&project.customMetadatas.BehaviorGraphExtension?(metadatas=project.customMetadatas.BehaviorGraphExtension,graphs=this_1.editor.core.scene.metadata.behaviorGraphs,(picker=new babylonjs_editor_1.Picker("Import Scripts From "+f.name+"...")).search=!0,picker.addItems(metadatas.graphs),picker.open(function(items){items.forEach(function(i){var graph=importFromFile?metadatas.graphs[i.id]:graphs[i.id],id=importFromFile?babylonjs_1.Tools.RandomId():graph.id;importFromFile&&(graph.id=id,graphs.push(graph)),_this.datas&&_this.datas.metadatas.push({active:!0,graphId:id})}),_this.editor.assets.refresh(_this.extension.id),_this.editor.graph.configure(),_this.objectSelected(_this.node)}),[2]):[2,"continue"]}})},this_1=this,_b.label=3;case 3:_b.trys.push([3,8,9,10]),files_1=__values(files),files_1_1=files_1.next(),_b.label=4;case 4:return files_1_1.done?[3,7]:(f=files_1_1.value,[5,_loop_1(f)]);case 5:_b.sent(),_b.label=6;case 6:return files_1_1=files_1.next(),[3,4];case 7:return[3,10];case 8:return e_1_1=_b.sent(),e_1={error:e_1_1},[3,10];case 9:try{files_1_1&&!files_1_1.done&&(_a=files_1.return)&&_a.call(files_1)}finally{if(e_1)throw e_1.error}return[7];case 10:return[2]}})})},BehaviorGraphEditor._CopiedGraph=null,BehaviorGraphEditor}(babylonjs_editor_1.EditorPlugin);exports.default=BehaviorGraphEditor})})(function(factory){module.exports=factory(require("babylonjs"),require("babylonjs-editor"),require("extensions/extensions.js"),require("litegraph.js"))});